<div class="content-wrapper px-4">
  <div class="card">
    <div class="card-header text-center bg-dark text-white">
      <h1>Liste des Produits</h1>
    </div>

    <div class="card-body">
      <div class="row">

        <!-- Sidebar filtres -->
        <aside class="col-lg-3 mb-4">
          <div class="card shadow-sm border-0 sticky-top rounded-4" style="top: 80px;">
            <div class="card-body">
              <h5 class="card-title fw-bold mb-3 fs-4 text-primary">
                <i class="bi bi-search"></i> Filtrer les produits
              </h5>

              <!-- Catégorie -->
              <div class="mb-3">
                <label class="form-label fw-semibold">Catégorie</label>
                <select class="form-select rounded-3" [(ngModel)]="filters.category_id" (change)="loadProducts()">
                  <option value="">Toutes les catégories</option>
                  <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
                </select>
              </div>

              <!-- Prix Min/Max -->
              <div class="mb-3">
                <label class="form-label fw-semibold">Prix Min</label>
                <input type="number" class="form-control rounded-3" [(ngModel)]="filters.min_price" (input)="loadProducts()" placeholder="Min">
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold">Prix Max</label>
                <input type="number" class="form-control rounded-3" [(ngModel)]="filters.max_price" (input)="loadProducts()" placeholder="Max">
              </div>

              <button class="btn btn-danger w-100 mt-2 rounded-3 shadow-sm" (click)="resetFilters()">
                <i class="bi bi-arrow-counterclockwise"></i> Réinitialiser
              </button>
            </div>
          </div>
        </aside>

        <!-- Tableau des produits -->
        <div class="col-lg-9">
          <a [routerLink]="['/create-product']" routerLinkActive="router-link-active" class="btn btn-primary my-3">
            Créer un nouveau produit
          </a>
          <div class="table-responsive">
            <table class="table table-striped table-bordered table-hover">
              <thead class="table-dark">
                <tr>
                  <th>Id</th>
                  <th>Nom</th>
                  <th>Prix</th>
                  <th>Référence</th>
                  <th>Quantité</th>
                  <th>Image</th>
                  <th>Catégorie</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let product of products">
                  <td>{{ product.id }}</td>
                  <td>{{ product.name }}</td>
                  <td>{{ product.price }}</td>
                  <td>{{ product.stock }}</td>
                  <td>{{ product.category.name }}</td>
                  <td>
                    <img *ngIf="product.photo" [src]="'http://localhost:8000/storage/' + product.photo" alt="Image produit"
                      width="80" height="80" class="img-thumbnail">
                  </td>
                  <td>{{ product.category.name || 'N/A' }}</td>
                  <td>
                    <button class="btn btn-primary btn-sm me-1" [routerLink]="['/edit-product', product.id]" routerLinkActive="router-link-active">Modifier</button>
                    <button class="btn btn-danger btn-sm" (click)="deleteProduct(product.id)">Supprimer</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          <nav class="d-flex justify-content-center mt-5">
            <button class="btn btn-outline-primary me-2 rounded-3" (click)="prevPage()" [disabled]="currentPage === 1">
              <i class="bi bi-chevron-left"></i> Précédent
            </button>
            <span class="align-self-center mx-2">Page {{ currentPage }} / {{ lastPage }}</span>
            <button class="btn btn-outline-primary ms-2 rounded-3" (click)="nextPage()" [disabled]="currentPage === lastPage">
              Suivant <i class="bi bi-chevron-right"></i>
            </button>
          </nav>
        </div>

      </div>
    </div>
  </div>
</div>
